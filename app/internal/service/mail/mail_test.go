package servicemail

import (
	"crypto/tls"
	"crypto/x509"
	"encoding/pem"
	"github.com/stretchr/testify/require"
	"go.uber.org/zap"
	"testing"
)

func TestSmtpMailService_SendMail(t *testing.T) {
	//https://mail.yandex.ru/?dpda=yes&uid=525211332#setup/client
	mailer := NewSmtpMailService(
		"smtp.yandex.com",
		465,
		"dvzamiatin@yandex.ru",
		"ugiriayxnmundnex",
		"",
		zap.NewNop(),
		"",
		"",
		"dvzamiatin@yandex.ru",
		true,
	)

	err := mailer.SendMail(
		"zamyatin.daniil@gmail.com",
		"Test",
		"Hello World",
	)

	require.NoError(t, err)
}

func TestSmtpMailServiceWithCert_SendMail(t *testing.T) {

	//https://mail.yandex.ru/?dpda=yes&uid=525211332#setup/client
	mailer := NewSmtpMailService(
		"smtp.yandex.com",
		465,
		"dvzamiatin@yandex.ru",
		"ugiriayxnmundnex",
		"dzami.ru",
		zap.NewNop(),
		cert,
		pk,
		"dvzamiatin@yandex.ru",
		//"zamyatin.daniil@gmail.com",
		true,
	)

	err := mailer.SendMail(
		"zamyatin.daniil@gmail.com",
		"Test",
		"Hello World",
	)

	require.NoError(t, err)
}

func TestCerts3(t *testing.T) {
	_, err := tls.X509KeyPair(
		[]byte(cert),
		[]byte(pk),
	)

	require.NoError(t, err)
}

func TestCerts2(t *testing.T) {

	b, _ := pem.Decode([]byte(cert))

	println(string(b.Bytes))

	//c, err := ParseCertificate(b.Bytes)
	_, err := x509.ParseCertificate(b.Bytes)

	require.NoError(t, err)
}

const crt = `-----BEGIN CERTIFICATE-----
MIIDETCCAfkCFHYGAXNm+Np2LT9PMZ7oYsdnNaV6MA0GCSqGSIb3DQEBCwUAMEUx
CzAJBgNVBAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRl
cm5ldCBXaWRnaXRzIFB0eSBMdGQwHhcNMjUwNzAyMTA0NTM3WhcNMjYwNzAyMTA0
NTM3WjBFMQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UE
CgwYSW50ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIIBIjANBgkqhkiG9w0BAQEFAAOC
AQ8AMIIBCgKCAQEA97lLB8KP/FeL7hs5T8O8l7aj9pPGeAKxbb4Upkc+MXFay5fr
WyjMP6bDdtHGh28raBca9+VOY/HVMu056KyhubLLL3AFHlwhCX4J1VzW5P/5BAXu
Jaz3oA12eZjiDUuHwljbr6K1el27YCZrCdjCPvR3fXtV1f6w8SxPo4qp5YgLJUIi
YN013Kkp1nKK3vGilHbGxJl8SUwfhZhk+dkrTfMdcVHXddgMTWT3zb63xgu8+BkM
ejF9tEeDdBrUzIzwBecxSg7imJ64s1vxTWWEc0ZYMHf818O0QD9aj/+E7i/uvGgi
4R7837vrNxiQgnfAj9LjrWM/WNq15k/Nm8WIswIDAQABMA0GCSqGSIb3DQEBCwUA
A4IBAQAuTmzNjGuFBkkrZscNL2cw1c2TFFhudLO46XBV2JC9/Bcr1VrnQahf9SzV
0Nr+DqNuSXbAvQGazD528XAYSmx1TO+kVzo6RUMWoqlEP8kTRm7jSEVL7QnhSZ5F
UGrc7K+h4IVuB7kZFT27CT/Xhd6EGaZ4bKZub+Cpty1Rwmnj0qg+BAxWkAUjh9bR
MMR7YuMQUU0N15KPLe36nVTYO5IjIH0C4OEnHVx/CCswFNzQNa7uHRMnfihsO6Mt
b6hblpt8LnCr7O1JZnwUIJtsgLuKhrm+cZs1dS++iQFPwxBelzK1NzipFrz4ks43
2PqH4FZjUxxhCp0jsIeb3KQ0kTde
-----END CERTIFICATE-----
`

const pk = `-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDtEaBsde62Q3Tg
mjS83G324hW2CrMhyTbLgqBEWze1BgHl/91OAX7/aAIz3R2iC5QoVcXdyG5gJQZQ
otU29uNRuawfvijYHdn9AwvSAzR7kyHAzYawpcYO/zXW3aVm+fM13a9xPVb9yeFz
7dXWAhkN90QZkamHN88a3OfSgZblqB/UE+lgmftlIY5tk9DLgFAkVeERArNJfrZV
wC6nzVRvb1wCQVTXw0GToJ3GsNu3jCgi7h8UUn0pNWmWU7tz2T+jaJGwjme57M5V
pFVbZzCNtF1rJtDD3WeYjX8aK2kTR1GKRSn7V16VbmXHM2Nq0dY8SyjIbYgcrMq6
DfauGCKLAgMBAAECggEASHoPFZmodUiCPvhmDydE5ymPgawbv8SIYAd7f+pzSYCg
q/RhcCu869Cce8ap/JSVow82Auv38qTfHV/q13b7YEzndnzod8oIjvWTc41PSkhd
FVjASNkliAg2KY5xtt3LoTg5HuGl6skBiDO6IEdb6Y0i4L5Lme9R/eBzb0P3IhaB
kldKxiJb+S/36B4qpSptUloSJYycVnrh4o4MyfSupwrDIQiW99zHsTlR/sfjopih
V3dSDhYWqzUs35tcNk+H+7Xj4Dk4IpSfXdpaTF6LOa55PhKTlkewDwDgYRFq7RGR
Hw0pvIPcsyfIP0yfsVlijPdaMKAny58dvTbe/6/KwQKBgQD9oPar2vLBYRfDejhH
HFgPOkSMQ4yygktrXtzQpy/iKWAZFnSmT3d51tA9osQ5yh/1RfM2Bmx3YbDPini/
Wx4C+FkaOPygb/oL2x4kgBxlbhUEJI3JVwYmma3ZtfuSW1M+XJEl685cNoHM4fJI
7WVrwqqvuG5gatVEMha4sc2T2QKBgQDvSQdM/VVtSGvn+paibdPXrEkvmc5/fIqh
ujlJw3iW+QWTAovTYCDa7bYdstlvqBDRgFAWhb61+7OEkioNGB8SnbKBqWLBKJCo
lhm825aKavwss952rSTbaNwTjiy4oqKUraYAkFupMytqp45KGO5vm2KKcIJ/S/JJ
6a0vFJU/AwKBgArJJJRMXFRy75LFiM0lXG1RWgbo/Hu+5LwtLZDF+1hP0CFg/hbw
fDE3PGXSnSuj99XzYpNilIxDIETDK71ff5g6vXdLAxtDh8unRtHgjNSXaNdjQpBU
XhOYJ3eBsLAZqCGXyChnrb/oJX70ANyvE8gQYDfWzQLWqDkdNDAoh4iJAoGBAMB3
cyHgGxh9yh2bmBIqWNz/PRbGlixBFpkjWvUT/ykgP/WRdLqedY7i6TtWIkMHYg/B
L6oOBeoG/MxDbQN/RW8J3Q0iG8bWRBT2NtmLnrjTeObT/rpiZmT9IRexohMY7cC9
M+r8Ml4URHXTNEYxa4fl6gsEmFKf2dDN3nkiCzHVAoGAfYkmOR94YVirgPKLm5lK
+a97azKMm6ODNgQJRwk1XTpRxUnE5TGf9VoO/W/futuNtJOIO5meNi/j8gBgGV3b
TrJm43vGiRXGS/zf2BepTLI3WSh7gU8EXAAka+SZRIXHYY1m1HAaP0N4FSIlbrIo
9mFHSOKYMjD9qvC2WCiSPtk=
-----END PRIVATE KEY-----
`

const cert = `-----BEGIN CERTIFICATE-----
MIIEBzCCAu+gAwIBAgIUVbZv2q2lsHkJEXPYXZCmO3RfGaQwDQYJKoZIhvcNAQEL
BQAwgZIxCzAJBgNVBAYTAlJVMRYwFAYDVQQIDA1TYW1hcmEgT2JsYXN0MREwDwYD
VQQHDAhUb2x5YXR0aTENMAsGA1UECgwERHphbTEQMA4GA1UECwwHT3JnVW5pdDEN
MAsGA1UEAwwEZHphbTEoMCYGCSqGSIb3DQEJARYZemFteWF0aW4uZGFuaWlsQGdt
YWlsLmNvbTAeFw0yNTA3MDIxMDAwMTdaFw0yNjA3MDIxMDAwMTdaMIGSMQswCQYD
VQQGEwJSVTEWMBQGA1UECAwNU2FtYXJhIE9ibGFzdDERMA8GA1UEBwwIVG9seWF0
dGkxDTALBgNVBAoMBER6YW0xEDAOBgNVBAsMB09yZ1VuaXQxDTALBgNVBAMMBGR6
YW0xKDAmBgkqhkiG9w0BCQEWGXphbXlhdGluLmRhbmlpbEBnbWFpbC5jb20wggEi
MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDtEaBsde62Q3TgmjS83G324hW2
CrMhyTbLgqBEWze1BgHl/91OAX7/aAIz3R2iC5QoVcXdyG5gJQZQotU29uNRuawf
vijYHdn9AwvSAzR7kyHAzYawpcYO/zXW3aVm+fM13a9xPVb9yeFz7dXWAhkN90QZ
kamHN88a3OfSgZblqB/UE+lgmftlIY5tk9DLgFAkVeERArNJfrZVwC6nzVRvb1wC
QVTXw0GToJ3GsNu3jCgi7h8UUn0pNWmWU7tz2T+jaJGwjme57M5VpFVbZzCNtF1r
JtDD3WeYjX8aK2kTR1GKRSn7V16VbmXHM2Nq0dY8SyjIbYgcrMq6DfauGCKLAgMB
AAGjUzBRMB0GA1UdDgQWBBRuo3G8gMHKEVM8cDM2PzF8oSDOLzAfBgNVHSMEGDAW
gBRuo3G8gMHKEVM8cDM2PzF8oSDOLzAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3
DQEBCwUAA4IBAQCvjWm/u0GGXf5cYFsU0td5lQ2T3LiLARHlsgZ6+K3W6HBA9qG7
CojzYvBHbOY2iqdKxt3bsJLLR1sQemf2ZbD+wu3JfmGLalVirRm2p6vtwyI6KIXG
v5KMGfVyQ7OTtG3oXvWGZiFuOx7gxyE6uBEvEVlD3/RYuXdmSEUWGUtSEuCXfPlH
uCJfBUPD+VHSyB7cS2uwbJgoOGlFZMjksvaInwyutmVUwv0heyalPOPgmXlxHXTX
U6yUFekm1IarUjIqP1idevAD8ssBctzHeiKONBAznKS0bB0VzJhoxC261Ih2C/xU
8/3bSXlB9vNTl6ngFeYossBC3MrRLCncHkTC
-----END CERTIFICATE-----
`

const batch = `-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDtEaBsde62Q3Tg
mjS83G324hW2CrMhyTbLgqBEWze1BgHl/91OAX7/aAIz3R2iC5QoVcXdyG5gJQZQ
otU29uNRuawfvijYHdn9AwvSAzR7kyHAzYawpcYO/zXW3aVm+fM13a9xPVb9yeFz
7dXWAhkN90QZkamHN88a3OfSgZblqB/UE+lgmftlIY5tk9DLgFAkVeERArNJfrZV
wC6nzVRvb1wCQVTXw0GToJ3GsNu3jCgi7h8UUn0pNWmWU7tz2T+jaJGwjme57M5V
pFVbZzCNtF1rJtDD3WeYjX8aK2kTR1GKRSn7V16VbmXHM2Nq0dY8SyjIbYgcrMq6
DfauGCKLAgMBAAECggEASHoPFZmodUiCPvhmDydE5ymPgawbv8SIYAd7f+pzSYCg
q/RhcCu869Cce8ap/JSVow82Auv38qTfHV/q13b7YEzndnzod8oIjvWTc41PSkhd
FVjASNkliAg2KY5xtt3LoTg5HuGl6skBiDO6IEdb6Y0i4L5Lme9R/eBzb0P3IhaB
kldKxiJb+S/36B4qpSptUloSJYycVnrh4o4MyfSupwrDIQiW99zHsTlR/sfjopih
V3dSDhYWqzUs35tcNk+H+7Xj4Dk4IpSfXdpaTF6LOa55PhKTlkewDwDgYRFq7RGR
Hw0pvIPcsyfIP0yfsVlijPdaMKAny58dvTbe/6/KwQKBgQD9oPar2vLBYRfDejhH
HFgPOkSMQ4yygktrXtzQpy/iKWAZFnSmT3d51tA9osQ5yh/1RfM2Bmx3YbDPini/
Wx4C+FkaOPygb/oL2x4kgBxlbhUEJI3JVwYmma3ZtfuSW1M+XJEl685cNoHM4fJI
7WVrwqqvuG5gatVEMha4sc2T2QKBgQDvSQdM/VVtSGvn+paibdPXrEkvmc5/fIqh
ujlJw3iW+QWTAovTYCDa7bYdstlvqBDRgFAWhb61+7OEkioNGB8SnbKBqWLBKJCo
lhm825aKavwss952rSTbaNwTjiy4oqKUraYAkFupMytqp45KGO5vm2KKcIJ/S/JJ
6a0vFJU/AwKBgArJJJRMXFRy75LFiM0lXG1RWgbo/Hu+5LwtLZDF+1hP0CFg/hbw
fDE3PGXSnSuj99XzYpNilIxDIETDK71ff5g6vXdLAxtDh8unRtHgjNSXaNdjQpBU
XhOYJ3eBsLAZqCGXyChnrb/oJX70ANyvE8gQYDfWzQLWqDkdNDAoh4iJAoGBAMB3
cyHgGxh9yh2bmBIqWNz/PRbGlixBFpkjWvUT/ykgP/WRdLqedY7i6TtWIkMHYg/B
L6oOBeoG/MxDbQN/RW8J3Q0iG8bWRBT2NtmLnrjTeObT/rpiZmT9IRexohMY7cC9
M+r8Ml4URHXTNEYxa4fl6gsEmFKf2dDN3nkiCzHVAoGAfYkmOR94YVirgPKLm5lK
+a97azKMm6ODNgQJRwk1XTpRxUnE5TGf9VoO/W/futuNtJOIO5meNi/j8gBgGV3b
TrJm43vGiRXGS/zf2BepTLI3WSh7gU8EXAAka+SZRIXHYY1m1HAaP0N4FSIlbrIo
9mFHSOKYMjD9qvC2WCiSPtk=
-----END PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIEBzCCAu+gAwIBAgIUVbZv2q2lsHkJEXPYXZCmO3RfGaQwDQYJKoZIhvcNAQEL
BQAwgZIxCzAJBgNVBAYTAlJVMRYwFAYDVQQIDA1TYW1hcmEgT2JsYXN0MREwDwYD
VQQHDAhUb2x5YXR0aTENMAsGA1UECgwERHphbTEQMA4GA1UECwwHT3JnVW5pdDEN
MAsGA1UEAwwEZHphbTEoMCYGCSqGSIb3DQEJARYZemFteWF0aW4uZGFuaWlsQGdt
YWlsLmNvbTAeFw0yNTA3MDIxMDAwMTdaFw0yNjA3MDIxMDAwMTdaMIGSMQswCQYD
VQQGEwJSVTEWMBQGA1UECAwNU2FtYXJhIE9ibGFzdDERMA8GA1UEBwwIVG9seWF0
dGkxDTALBgNVBAoMBER6YW0xEDAOBgNVBAsMB09yZ1VuaXQxDTALBgNVBAMMBGR6
YW0xKDAmBgkqhkiG9w0BCQEWGXphbXlhdGluLmRhbmlpbEBnbWFpbC5jb20wggEi
MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDtEaBsde62Q3TgmjS83G324hW2
CrMhyTbLgqBEWze1BgHl/91OAX7/aAIz3R2iC5QoVcXdyG5gJQZQotU29uNRuawf
vijYHdn9AwvSAzR7kyHAzYawpcYO/zXW3aVm+fM13a9xPVb9yeFz7dXWAhkN90QZ
kamHN88a3OfSgZblqB/UE+lgmftlIY5tk9DLgFAkVeERArNJfrZVwC6nzVRvb1wC
QVTXw0GToJ3GsNu3jCgi7h8UUn0pNWmWU7tz2T+jaJGwjme57M5VpFVbZzCNtF1r
JtDD3WeYjX8aK2kTR1GKRSn7V16VbmXHM2Nq0dY8SyjIbYgcrMq6DfauGCKLAgMB
AAGjUzBRMB0GA1UdDgQWBBRuo3G8gMHKEVM8cDM2PzF8oSDOLzAfBgNVHSMEGDAW
gBRuo3G8gMHKEVM8cDM2PzF8oSDOLzAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3
DQEBCwUAA4IBAQCvjWm/u0GGXf5cYFsU0td5lQ2T3LiLARHlsgZ6+K3W6HBA9qG7
CojzYvBHbOY2iqdKxt3bsJLLR1sQemf2ZbD+wu3JfmGLalVirRm2p6vtwyI6KIXG
v5KMGfVyQ7OTtG3oXvWGZiFuOx7gxyE6uBEvEVlD3/RYuXdmSEUWGUtSEuCXfPlH
uCJfBUPD+VHSyB7cS2uwbJgoOGlFZMjksvaInwyutmVUwv0heyalPOPgmXlxHXTX
U6yUFekm1IarUjIqP1idevAD8ssBctzHeiKONBAznKS0bB0VzJhoxC261Ih2C/xU
8/3bSXlB9vNTl6ngFeYossBC3MrRLCncHkTC
-----END CERTIFICATE-----
`
