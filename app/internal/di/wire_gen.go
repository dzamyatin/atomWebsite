// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package di

import (
	"fmt"
	"github.com/dzamyatin/atomWebsite/internal/grpc/generated"
	"github.com/dzamyatin/atomWebsite/internal/service/grpc"
	"github.com/dzamyatin/atomWebsite/internal/service/process"
	"go.uber.org/zap"
	"go.uber.org/zap/zapcore"
	"google.golang.org/grpc"
	"log"
	"net"
	"os"
)

// Injectors from grpc.go:

func InitializeGRPCProcessManager() *process.ProcessManager {
	logger := newLogger()
	authServer := grpcservice.NewAuthServer()
	server := newGrpcServer(authServer)
	grpcServer := newServer(server)
	signalListener := process.NewSignalListener(logger)
	processManager := newGRPCProcessManager(logger, grpcServer, signalListener)
	return processManager
}

// grpc.go:

func newGRPCProcessManager(
	logger *zap.Logger,
	serv *grpcservice.GRPCServer,
	listener *process.SignalListener,
) *process.ProcessManager {
	return process.NewProcessManager(
		logger, process.Process{
			Name:   "grpc server",
			Object: serv,
		}, process.Process{
			Name:   "signal listener",
			Object: listener,
		},
	)
}

func newLogger() *zap.Logger {
	return zap.New(zapcore.NewCore(zapcore.NewJSONEncoder(zap.NewProductionEncoderConfig()), zapcore.AddSync(os.Stdout), zapcore.InfoLevel),
	)
}

func newServer(
	grpcServer *grpc.Server,
) *grpcservice.GRPCServer {
	lis, err := net.Listen("tcp", fmt.Sprintf("localhost:%d", 8502))
	if err != nil {
		log.Fatalf("failed to listen: %v", err)
	}

	return grpcservice.NewGRPCServer(
		lis,
		grpcServer,
	)
}

func newGrpcServer(server grpcservice.AuthServer) *grpc.Server {
	grpcServer := grpc.NewServer()
	atomWebsite.RegisterAuthServer(grpcServer, server)

	return grpcServer
}
